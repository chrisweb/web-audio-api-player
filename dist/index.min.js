class e{constructor(e){this.url=null,this.codec=null,this.loop=!1,this.sourceNode=null,this.gainNode=null,this.isReadyToPLay=!1,this.isBuffered=!1,this.isBuffering=!1,this.audioElement=null,this.audioBuffer=null,this.arrayBuffer=null,this.audioBufferDate=null,this.playTimeOffset=0,this.startTime=0,this.playTime=0,this.playedTimePercentage=0,this.state="sound_state_stopped",this.loadingProgress=0,this.duration=null,this.durationSetManually=!1,this.firstTimePlayed=!0,this.isConnectToPlayerGain=!1,this.elapsedPlayTime=0,this.seekPercentage=0,Array.isArray(e.source)?this.source=e.source:this.source=[e.source],void 0!==e.id?this.id=e.id:this.id=this._generateSoundId(),this.loop=e.loop||!1,this.seekPercentage=e.seekPercentage||0,isNaN(e.duration)||(this.duration=e.duration,this.durationSetManually=!0),"function"==typeof e.onLoading?this.onLoading=e.onLoading:this.onLoading=null,"function"==typeof e.onPlaying?this.onPlaying=e.onPlaying:this.onPlaying=null,"function"==typeof e.onStarted?this.onStarted=e.onStarted:this.onStarted=null,"function"==typeof e.onEnded?this.onEnded=e.onEnded:this.onEnded=null,"function"==typeof e.onStopped?this.onStopped=e.onStopped:this.onStopped=null,"function"==typeof e.onPaused?this.onPaused=e.onPaused:this.onPaused=null,"function"==typeof e.onResumed?this.onResumed=e.onResumed:this.onResumed=null,"function"==typeof e.onSeeking?this.onSeeking=e.onSeeking:this.onSeeking=null,e.arrayBuffer instanceof ArrayBuffer&&(this.arrayBuffer=e.arrayBuffer),e.audioBuffer instanceof AudioBuffer&&(this.audioBuffer=e.audioBuffer,this.isBuffering=!1,this.isBuffered=!0,this.audioBufferDate=new Date,this.durationSetManually||(this.duration=this.audioBuffer.duration))}getCurrentTime(){let e;return null!==this.sourceNode&&(this.sourceNode instanceof AudioBufferSourceNode?e=this.sourceNode.context.currentTime-this.startTime+this.elapsedPlayTime:this.sourceNode instanceof MediaElementAudioSourceNode&&(e=this.audioElement.currentTime)),e}getDuration(){return this.duration}setDuration(e){isNaN(e)||(this.duration=e,this.durationSetManually=!0)}setLoop(t){this.loop=t,this.state===e.SOUND_STATE_PLAYING&&null!==this.sourceNode&&(this.sourceNode instanceof AudioBufferSourceNode?this.sourceNode.loop=t:this.sourceNode instanceof MediaElementAudioSourceNode&&(this.sourceNode.mediaElement.loop=t))}getLoop(){return this.loop}_generateSoundId(){return Date.now().toString(36)+Math.random().toString(36).substring(2)}}e.SOUND_STATE_STOPPED="sound_state_stopped",e.SOUND_STATE_PAUSED="sound_state_paused",e.SOUND_STATE_PLAYING="sound_state_playing",e.SOUND_STATE_SEEKING="sound_state_seeking";class t{constructor(e){this._audioContext=null,this._volume=null,this._audioNodes={gainNode:null},this._audioElement=null,this._mediaElementAudioSourceNode=null,this._isAudioUnlocked=!1,this._isAudioUnlocking=!1,this._options=e,this._initialize()}_initialize(){this._options.unlockAudioOnFirstUserInteraction&&this._addFirstUserInteractionEventListeners()}getAudioNodes(){return this._audioNodes}async decodeAudio(e){const t=await this.getAudioContext();return await t.decodeAudioData(e)}_createAudioContext(){if(this._audioContext instanceof AudioContext)return;const e=window.AudioContext||window.webkitAudioContext;null!==this._options.audioContext?this._audioContext=this._options.audioContext:this._audioContext=new e}_addFirstUserInteractionEventListeners(){this._options.unlockAudioOnFirstUserInteraction&&(document.addEventListener("keydown",this.unlockAudio.bind(this)),document.addEventListener("mousedown",this.unlockAudio.bind(this)),document.addEventListener("pointerdown",this.unlockAudio.bind(this)),document.addEventListener("pointerup",this.unlockAudio.bind(this)),document.addEventListener("touchend",this.unlockAudio.bind(this)))}_removeFirstUserInteractionEventListeners(){this._options.unlockAudioOnFirstUserInteraction&&(document.removeEventListener("keydown",this.unlockAudio.bind(this)),document.removeEventListener("mousedown",this.unlockAudio.bind(this)),document.removeEventListener("pointerdown",this.unlockAudio.bind(this)),document.removeEventListener("pointerup",this.unlockAudio.bind(this)),document.removeEventListener("touchend",this.unlockAudio.bind(this)))}unlockAudio(){return new Promise(((e,t)=>{if(this._isAudioUnlocking)return e();if(this._isAudioUnlocked)return e();if(this._isAudioUnlocking=!0,"player_mode_audio"===this._options.loadPlayerMode){const e=!0;this._createAudioElement(e).catch((e=>(this._isAudioUnlocking=!1,t())))}this.getAudioContext().then((()=>{const t=this._audioContext.createBuffer(1,1,22050);let i=this._audioContext.createBufferSource();i.onended=()=>(i.disconnect(0),this._removeFirstUserInteractionEventListeners(),i.disconnect(0),i.buffer=null,i=null,this._isAudioUnlocked=!0,this._isAudioUnlocking=!1,e()),i.buffer=t,i.connect(this._audioContext.destination),i.start(0)})).catch((e=>(this._isAudioUnlocking=!1,t())))}))}async _createAudioElementAndSource(){await this._createAudioElement(),await this._createMediaElementAudioSourceNode()}async _createAudioElement(e){if(null===this._audioElement||!0===e){const e=new Audio;e.controls=!1,e.autoplay=!1,e.preload="auto",e.volume=1,e.id="web-audio-api-player",this._audioElement=e,this._options.addAudioElementsToDom&&document.body.appendChild(e)}}async getAudioElement(){return null===this._audioElement&&await this._createAudioElementAndSource(),this._audioElement}async getAudioContext(){return null===this._audioContext||"closed"===this._audioContext.state?await this._createAudioContext():"suspended"===this._audioContext.state&&await this.unfreezeAudioContext(),this._audioContext}unfreezeAudioContext(){return void 0===this._audioContext.resume?Promise.resolve():this._audioContext.resume()}freezeAudioContext(){return void 0===this._audioContext.suspend?Promise.resolve():this._audioContext.suspend()}isAudioContextFrozen(){return"suspended"===this._audioContext.state}detectAudioContextSupport(){let e=!1;return(void 0!==window.webkitAudioContext||"undefined"!=typeof AudioContext)&&(e=!0),e}detectAudioElementSupport(){return!!document.createElement("audio").canPlayType}async _createAudioBufferSourceNode(){return(await this.getAudioContext()).createBufferSource()}async _createMediaElementAudioSourceNode(){if(null===this._mediaElementAudioSourceNode&&null!==this._audioElement){const e=await this.getAudioContext();this._mediaElementAudioSourceNode=e.createMediaElementSource(this._audioElement)}}_destroyMediaElementAudioSourceNode(){null!==this._mediaElementAudioSourceNode&&(void 0!==this._mediaElementAudioSourceNode.mediaElement&&this._mediaElementAudioSourceNode.mediaElement.remove(),this._mediaElementAudioSourceNode.disconnect(),this._mediaElementAudioSourceNode=null)}_destroyAudioBufferSourceNode(){null!==this._mediaElementAudioSourceNode&&this._mediaElementAudioSourceNode.disconnect()}async _destroyAudioContext(){null!==this._audioContext&&"closed"!==this._audioContext.state&&(await this._audioContext.close(),this._audioContext=null)}async shutDown(e){this._removeFirstUserInteractionEventListeners(),e.forEach((e=>{this.disconnectSound(e)})),this._destroyMediaElementAudioSourceNode(),this._destroyAudioBufferSourceNode(),this._disconnectPlayerGainNode(),await this._destroyAudioContext()}async _getPlayerGainNode(){let e;if(this._audioNodes.gainNode instanceof GainNode)e=this._audioNodes.gainNode;else{const t=await this.getAudioContext();e=t.createGain(),this._initializeVolume(e),e.connect(t.destination),this._audioNodes.gainNode=e}return e}_disconnectPlayerGainNode(){null!==this._audioNodes.gainNode&&(this._audioNodes.gainNode.disconnect(),this._audioNodes.gainNode=null)}async connectSound(e,t){if(e.isConnectToPlayerGain)return;if("player_mode_ajax"===this._options.loadPlayerMode){const i=await this._createAudioBufferSourceNode();e.gainNode=i.context.createGain(),i.connect(e.gainNode),i.loop=e.loop,i.onended=t,e.sourceNode=i}else"player_mode_audio"===this._options.loadPlayerMode&&(await this._createAudioElementAndSource(),e.gainNode=this._mediaElementAudioSourceNode.context.createGain(),this._mediaElementAudioSourceNode.connect(e.gainNode),this._mediaElementAudioSourceNode.mediaElement.loop=e.loop,this._mediaElementAudioSourceNode.mediaElement.onended=t,e.sourceNode=this._mediaElementAudioSourceNode);e.gainNode.gain.value=1;const i=await this._getPlayerGainNode();e.gainNode.connect(i),e.isConnectToPlayerGain=!0}async disconnectSound(e){e.isConnectToPlayerGain&&(null!==e.sourceNode&&(e.sourceNode.disconnect(),e.sourceNode=null),null!==e.gainNode&&(e.gainNode.disconnect(),e.gainNode=null,e.isConnectToPlayerGain=!1),null!==e.audioElement&&(e.audioElement=null))}async _changePlayerGainValue(e){if(this._audioNodes.gainNode instanceof GainNode){const t=await this.getAudioContext(),i=(!isNaN(this._options.volumeTransitionTime)&&this._options.volumeTransitionTime>0?this._options.volumeTransitionTime:100)/1e3;try{this._audioNodes.gainNode.gain.setTargetAtTime(e,t.currentTime,i)}catch(e){}}}async setVolume(e,t=!0){this._options.persistVolume&&t&&localStorage.setItem("WebAudioAPIPlayerVolume",e.toString());const i=e/100;if(this._audioNodes.gainNode instanceof GainNode){i!==Math.round(100*(this._audioNodes.gainNode.gain.value+Number.EPSILON))/100&&await this._changePlayerGainValue(i)}return this._volume=e,e}getVolume(){let e;if(null!==this._volume)e=this._volume;else if(this._options.persistVolume){e=parseInt(localStorage.getItem("WebAudioAPIPlayerVolume"))}return(void 0===e||isNaN(e))&&(e=isNaN(this._options.volume)?80:this._options.volume),this._volume=e,e}_initializeVolume(e){if(this._options.persistVolume){const t=parseInt(localStorage.getItem("WebAudioAPIPlayerVolume")),i=t/100;isNaN(t)||(e.gain.value=i),this._volume=t}if(null===this._volume){const t=this._options.volume/100;e.gain.value=t,this._volume=this._options.volume}}}class i{getArrayBuffer(e){return new Promise((function(t,i){const o=new XMLHttpRequest;o.open("GET",e.url,!0),o.responseType="arraybuffer",o.onload=function(){o.status>=200&&o.status<=299?t(o.response):i(new Error(o.statusText+"(status:"+o.status+")"))},o.onprogress=function(t){const i=100/(t.total/t.loaded),o=Math.round(i);e.loadingProgress=o,null!==e.onLoading&&e.onLoading(o,t.total,t.loaded)},o.onerror=function(e){i(e)},o.send()}))}}class o{constructor(t={}){this._playingProgressRequestId=null,this._postMuteVolume=null,this._postVisibilityHiddenPlaying=null,this._progressTrigger=(t,i)=>{const n=this._getSoundFromQueue({whichSound:o.CURRENT_SOUND});if(t.id===n.id&&n.state===e.SOUND_STATE_PLAYING){if(i-this._playingProgressPreviousTimestamp>=this._options.playingProgressIntervalTime){const e=t.getCurrentTime(),o=t.getDuration();if(!isNaN(e)&&!isNaN(o)){let n=0;if(0!==e){const t=e/o*100;n=Math.round(t)}t.playedTimePercentage=n,t.playTime=e,t.onPlaying(n,o,e),this._playingProgressPreviousTimestamp=i}}this._playingProgressRequestId=window.requestAnimationFrame((e=>{this._progressTrigger(t,e)}))}};const i={volume:80,loopQueue:!1,loopSong:!1,soundsBaseUrl:"",playingProgressIntervalTime:200,playNextOnEnded:!0,stopOnReset:!0,visibilityWatch:!1,visibilityHiddenAction:"visibility_hidden_action_pause",unlockAudioOnFirstUserInteraction:!1,persistVolume:!0,loadPlayerMode:"player_mode_audio",audioContext:null,addAudioElementsToDom:!1,volumeTransitionTime:100},n=Object.assign({},i,t);this._queue=[],this._currentIndex=0,this._options=n,this._playingProgressPreviousTimestamp=0,this._initialize()}_initialize(){const e=this._audioOptions();switch(this._playerAudio=new t(e),this._options.loadPlayerMode){case o.PLAYER_MODE_AUDIO:if(!this._playerAudio.detectAudioContextSupport())throw new Error("audio context is not supported by this device");if(!this._playerAudio.detectAudioElementSupport())throw new Error("audio element is not supported by this device");break;case o.PLAYER_MODE_AJAX:if(!this._playerAudio.detectAudioContextSupport())throw new Error("audio context is not supported by this device")}}_audioOptions(){return{audioContext:this._options.audioContext,unlockAudioOnFirstUserInteraction:this._options.unlockAudioOnFirstUserInteraction,volume:this._options.volume,persistVolume:this._options.persistVolume,loadPlayerMode:this._options.loadPlayerMode,addAudioElementsToDom:this._options.addAudioElementsToDom,volumeTransitionTime:this._options.volumeTransitionTime}}addSoundToQueue({soundAttributes:t,whereInQueue:i="append"}){const n=new e(t);switch(i){case o.WHERE_IN_QUEUE_AT_END:this._appendSoundToQueue(n);break;case o.WHERE_IN_QUEUE_AT_START:this._prependSoundToQueue(n)}return n}_appendSoundToQueue(e){this._queue.push(e)}_prependSoundToQueue(e){this._queue.unshift(e)}async resetQueue(){this._options.stopOnReset&&await this.stop(),this._queue.forEach((e=>{this._playerAudio.disconnectSound(e)})),this._queue=[]}reset(){this.resetQueue().catch((e=>{}))}getQueue(){return this._queue}setVolume(e){this._playerAudio.setVolume(e).catch((e=>{}))}getVolume(){return this._playerAudio.getVolume()}setLoopQueue(e){this._options.loopQueue=e}getLoopQueue(){return this._options.loopQueue}mute(){const e=this.getVolume();this._playerAudio.setVolume(0,!1).catch((e=>{})),this._postMuteVolume=e}unMute(){this._playerAudio.setVolume(this._postMuteVolume,!1).catch((e=>{})),this._postMuteVolume=null}isMuted(){return null!==this._postMuteVolume}async setPosition(e){if(e<0||e>100)throw new Error("soundPositionInPercent must be a number >= 0 and <= 100");const t=this._getSoundFromQueue({whichSound:o.CURRENT_SOUND});if(null!==t){t.seekPercentage=Math.round(e);const i=t.getDuration();null===i||isNaN(i)?await this.loadSound(t,o.AFTER_LOADING_SEEK):this._setPosition(t)}}_setPosition(e){const t=e.getDuration()/100*e.seekPercentage;this.setPositionInSeconds(t,e)}async setPositionInSeconds(t,i){let n=null;if(n=void 0!==i?i:this._getSoundFromQueue({whichSound:o.CURRENT_SOUND}),null!==n){!isNaN(n.duration)&&t>=n.duration&&(t=n.duration-.1);const i=n.state;if(n.state=e.SOUND_STATE_SEEKING,null!==n.onSeeking){const e=t,i=n.getDuration(),o=e/i*100,s=Math.round(o);n.onSeeking(s,i,e)}i===e.SOUND_STATE_PLAYING?(n.playTime=t,this._options.loadPlayerMode===o.PLAYER_MODE_AJAX?(n.elapsedPlayTime=t,await this._stop(n)):this._options.loadPlayerMode===o.PLAYER_MODE_AUDIO&&await this._play(n)):n.playTime=t}}async loadSound(e,t){switch(this._options.loadPlayerMode){case o.PLAYER_MODE_AUDIO:await this._loadSoundUsingAudioElement(e,t);break;case o.PLAYER_MODE_AJAX:await this._loadSoundUsingRequest(e,t);case o.PLAYER_MODE_FETCH:}return e}async _loadSoundUsingAudioElement(e,t){const{url:i,codec:n=null}=this._findBestSource(e.source);if(e.url=i,e.codec=n,null===e.url)throw new Error("sound has no url");{e.audioElement=await this._playerAudio.getAudioElement(),e.audioElement.onprogress=()=>{if(e.audioElement&&e.audioElement.buffered.length){let t;const i=e.audioElement.buffered.end(0),o=e.getDuration();if(void 0!==o){const e=100/(o/i);t=Math.round(e)}e.loadingProgress=t,null!==e.onLoading&&e.onLoading(t,o,i),100===t&&(e.isBuffering=!1,e.isBuffered=!0,e.audioBufferDate=new Date)}};const i=async()=>{if(e.audioElement)switch(e.audioElement.removeEventListener("canplaythrough",i),e.isReadyToPLay=!0,isNaN(e.audioElement.duration)||e.durationSetManually||(e.duration=e.audioElement.duration),t){case o.AFTER_LOADING_SEEK:this._setPosition(e);break;case o.AFTER_LOADING_PLAY:this._play(e)}};e.audioElement.addEventListener("canplaythrough",i),e.audioElement.crossOrigin="anonymous",e.audioElement.src=e.url,e.audioElement.load()}}async _loadSoundUsingRequest(e,t){if(null!==e.arrayBuffer)return await this._decodeSound(e);const{url:o,codec:n=null}=this._findBestSource(e.source);if(e.url=o,e.codec=n,null===e.url)throw new Error("sound has no url");{const o=new i;e.isBuffering=!0;const n=await o.getArrayBuffer(e);e.arrayBuffer=n,await this._decodeSound(e,t)}}async _decodeSound(e,t){const i=e.arrayBuffer.slice(0),n=await this._playerAudio.decodeAudio(i);switch(isNaN(n.duration)||e.durationSetManually||(e.duration=n.duration),e.audioBuffer=n,e.isBuffering=!1,e.isBuffered=!0,e.audioBufferDate=new Date,e.isReadyToPLay=!0,t){case o.AFTER_LOADING_SEEK:this._setPosition(e);break;case o.AFTER_LOADING_PLAY:this._play(e)}}async play({whichSound:t,playTimeOffset:i}={}){const n=this._getSoundFromQueue({whichSound:o.CURRENT_SOUND}),s=this._getSoundFromQueue({whichSound:t,updateIndex:!0});return null===s?s:null!==n&&n.state===e.SOUND_STATE_PLAYING&&n.id===s.id?(isNaN(i)||this.setPositionInSeconds(i),s):(null===n||n.state!==e.SOUND_STATE_PLAYING&&n.state!==e.SOUND_STATE_PAUSED||n.id===s.id||(n.state=e.SOUND_STATE_STOPPED,await this._stop(n)),isNaN(i)?s.playTimeOffset=0:s.playTimeOffset=i,null===s.sourceNode&&await this._playerAudio.connectSound(s,(()=>{this._onEnded()})),s.isReadyToPLay?await this._play(s):await this.loadSound(s,o.AFTER_LOADING_PLAY),s)}async _play(t){t.state!==e.SOUND_STATE_PLAYING&&(this._playerAudio.isAudioContextFrozen()&&await this._playerAudio.unfreezeAudioContext(),t.playTimeOffset>0&&(t.playTime=t.playTimeOffset),this._options.loadPlayerMode===o.PLAYER_MODE_AJAX?await this._playAudioBuffer(t):this._options.loadPlayerMode===o.PLAYER_MODE_AUDIO&&await this._playMediaElementAudio(t),t.state=e.SOUND_STATE_PLAYING,this._triggerSoundCallbacks(t))}async _playAudioBuffer(t){if(t.sourceNode instanceof AudioBufferSourceNode){t.startTime=t.sourceNode.context.currentTime,t.sourceNode.buffer=t.audioBuffer;try{t.state===e.SOUND_STATE_SEEKING||t.state===e.SOUND_STATE_PAUSED&&0===t.playTimeOffset?t.sourceNode.start(0,t.playTime):t.playTimeOffset>0?(t.playTimeOffset,Math.ceil(t.duration),t.elapsedPlayTime=t.playTimeOffset,t.sourceNode.start(0,t.playTimeOffset)):t.sourceNode.start()}catch(e){throw new Error(e)}}}async _playMediaElementAudio(t){if(t.sourceNode instanceof MediaElementAudioSourceNode)return t.state===e.SOUND_STATE_SEEKING||t.state===e.SOUND_STATE_PAUSED&&0===t.playTimeOffset?t.audioElement.currentTime=t.playTime:t.playTimeOffset>0?(t.playTimeOffset,Math.ceil(t.duration),t.audioElement.currentTime=t.playTimeOffset):t.audioElement.currentTime=0,await t.audioElement.play()}_triggerSoundCallbacks(e){null===e.onResumed||e.firstTimePlayed||e.onResumed(e.playTime),null!==e.onStarted&&e.firstTimePlayed&&(e.firstTimePlayed=!1,e.onStarted(e.playTimeOffset)),null!==e.onPlaying?(this._playingProgressPreviousTimestamp=0,this._progressTrigger(e,0)):this._playingProgressRequestId=null}async _onEnded(){if(this._options.playNextOnEnded){const t=this._getSoundFromQueue({whichSound:o.CURRENT_SOUND});if(null!==t){if(this._options.loadPlayerMode===o.PLAYER_MODE_AUDIO||this._options.loadPlayerMode===o.PLAYER_MODE_AJAX&&t.state===e.SOUND_STATE_PLAYING){let e=!1;null!==this._getSoundFromQueue({whichSound:o.PLAY_SOUND_NEXT})&&(e=!0),e||await this._playerAudio.freezeAudioContext(),null!==t.onEnded&&t.onEnded(e);try{e&&await this.next()}catch(e){}}if(this._options.loadPlayerMode===o.PLAYER_MODE_AJAX&&t.state===e.SOUND_STATE_SEEKING)try{await this.play(t)}catch(e){}}}}_getSoundFromQueue({whichSound:e,updateIndex:t=!1}={}){let i=null,n=null;if(0===this._queue.length)return i;switch(void 0===e&&(e=o.CURRENT_SOUND),e){case o.CURRENT_SOUND:n=this._currentIndex,i=this._queue[n];break;case o.PLAY_SOUND_NEXT:void 0!==this._queue[this._currentIndex+1]?(n=this._currentIndex+1,i=this._queue[n]):this._options.loopQueue&&(n=0,i=this._queue[n]);break;case o.PLAY_SOUND_PREVIOUS:void 0!==this._queue[this._currentIndex-1]?(n=this._currentIndex-1,i=this._queue[n]):this._options.loopQueue&&(n=this._queue.length-1,i=this._queue[n]);break;case o.PLAY_SOUND_FIRST:this._queue.length>0&&(n=0,i=this._queue[n]);break;case o.PLAY_SOUND_LAST:this._queue.length>0&&(n=this._queue.length-1,i=this._queue[n]);break;default:[i,n]=this._findSoundById({soundId:e})}return null!==n&&t&&(this._currentIndex=n),i}_findSoundById({soundId:e}){let t=null,i=0;return this._queue.some(((o,n)=>{if(o.id===e)return t=o,i=n,!0})),[t,i]}_findBestSource(e){const t={url:null,codec:null};let i;i=Array.isArray(e)?e:[e];let o=0;for(;o<i.length;){const e=i[o];let n="";""!==this._options.soundsBaseUrl&&(n=this._options.soundsBaseUrl),n+=e.url;let s=!0;if(null!==e.codec&&(s=this._checkCodecSupport(e.codec)),s){if(e.isPreferred){t.url=n,t.codec=e.codec;break}t.url=n,t.codec=e.codec}o++}return t}_checkCodecSupport(e){let t,i="";switch(e){case"ogg":case"oga":t=['audio/ogg; codecs="vorbis"'];break;case"mp3":t=['audio/mpeg; codecs="mp3"'];break;case"opus":t=['audio/ogg; codecs="opus"','audio/webm; codecs="opus"'];break;case"wav":t=['audio/wav; codecs="1"'];break;case"m4a":t=["audio/m4a;","audio/x-m4a;"];break;case"m4p":t=["audio/m4p;","audio/x-m4p;"];break;case"caf":t=["audio/x-caf;"];break;case"aac":t=["audio/aac;"];break;case"weba":case"webm":t=['audio/webm; codecs="vorbis"'];break;case"flac":t=["audio/flac;","audio/x-flac;"];break;default:i="unrecognised codec"}if(i)throw new Error(i);return this._checkMimeTypesSupport(t)}_checkMimeTypesSupport(e){const t=new Audio;let i=!1;return e.forEach((e=>{t.canPlayType(e).replace(/^no$/,"")&&(i=!0)})),i}async pause(){const t=this._getSoundFromQueue({whichSound:o.CURRENT_SOUND});if(null===t)return;if(t.state===e.SOUND_STATE_PAUSED)return;const i=t.getCurrentTime();return t.playTime=i,this._options.loadPlayerMode===o.PLAYER_MODE_AJAX&&(t.elapsedPlayTime=i),null!==t.onPaused&&t.onPaused(t.playTime),t.state=e.SOUND_STATE_PAUSED,await this._stop(t),t}async stop(){const t=this._getSoundFromQueue({whichSound:o.CURRENT_SOUND});if(null!==t&&t.state!==e.SOUND_STATE_STOPPED)return await this._playerAudio.freezeAudioContext(),null!==t.onStopped&&t.onStopped(t.playTime),t.state=e.SOUND_STATE_STOPPED,await this._stop(t),t}async _stop(t){null!==this._playingProgressRequestId&&(cancelAnimationFrame(this._playingProgressRequestId),this._playingProgressRequestId=null),null!==t.sourceNode&&(t.sourceNode instanceof AudioBufferSourceNode&&(t.sourceNode.stop(0),await this._playerAudio.disconnectSound(t)),t.sourceNode instanceof MediaElementAudioSourceNode&&t.audioElement.pause()),t.state===e.SOUND_STATE_STOPPED&&(t.isReadyToPLay=!1,t.firstTimePlayed=!0,t.startTime=0,t.elapsedPlayTime=0,t.playTime=0,t.playedTimePercentage=0,await this._playerAudio.disconnectSound(t))}async next(){return await this.play({whichSound:o.PLAY_SOUND_NEXT})}async previous(){return await this.play({whichSound:o.PLAY_SOUND_PREVIOUS})}async first(){return await this.play({whichSound:o.PLAY_SOUND_FIRST})}async last(){return await this.play({whichSound:o.PLAY_SOUND_LAST})}setVisibilityWatch(e){this._options.visibilityWatch=e,e?document.addEventListener("visibilitychange",this._handleVisibilityChange.bind(this),!1):document.removeEventListener("visibilitychange",this._handleVisibilityChange.bind(this),!1)}getVisibilityWatch(){return this._options.visibilityWatch}setVisibilityHiddenAction(e){this._options.visibilityHiddenAction=e}getVisibilityHiddenAction(){return this._options.visibilityHiddenAction}_handleVisibilityChange(){let t;if(void 0!==document.hidden?t="hidden":void 0!==document.msHidden?t="msHidden":void 0!==document.webkitHidden&&(t="webkitHidden"),document[t])if(this._options.visibilityHiddenAction===o.VISIBILITY_HIDDEN_ACTION_PAUSE){const t=this._getSoundFromQueue({whichSound:o.CURRENT_SOUND});if(null===t)return;t.state===e.SOUND_STATE_PLAYING?(this.pause(),this._postVisibilityHiddenPlaying=!0):this._postVisibilityHiddenPlaying=!1}else this._options.visibilityHiddenAction===o.VISIBILITY_HIDDEN_ACTION_MUTE&&this.mute();else this._options.visibilityHiddenAction===o.VISIBILITY_HIDDEN_ACTION_PAUSE&&!0===this._postVisibilityHiddenPlaying?this.play():this._options.visibilityHiddenAction===o.VISIBILITY_HIDDEN_ACTION_MUTE&&this.unMute()}async manuallyUnlockAudio(){await this._playerAudio.unlockAudio()}async disconnect(){null!==this._playingProgressRequestId&&(cancelAnimationFrame(this._playingProgressRequestId),this._playingProgressRequestId=null),await this._playerAudio.shutDown(this._queue)}async getAudioContext(){return await this._playerAudio.getAudioContext()}getCurrentSound(){return this._getSoundFromQueue({whichSound:o.CURRENT_SOUND})}}o.WHERE_IN_QUEUE_AT_END="append",o.WHERE_IN_QUEUE_AT_START="prepend",o.AFTER_LOADING_SEEK="after_loading_seek",o.AFTER_LOADING_PLAY="after_loading_play",o.PLAY_SOUND_NEXT="next",o.PLAY_SOUND_PREVIOUS="previous",o.PLAY_SOUND_FIRST="first",o.PLAY_SOUND_LAST="last",o.CURRENT_SOUND="current",o.PLAYER_MODE_AUDIO="player_mode_audio",o.PLAYER_MODE_AJAX="player_mode_ajax",o.PLAYER_MODE_FETCH="player_mode_fetch",o.VISIBILITY_HIDDEN_ACTION_MUTE="visibility_hidden_action_mute",o.VISIBILITY_HIDDEN_ACTION_PAUSE="visibility_hidden_action_pause";export{o as PlayerCore,e as PlayerSound};
//# sourceMappingURL=index.min.js.map
